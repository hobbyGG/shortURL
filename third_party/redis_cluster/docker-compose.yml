services:
  redis-master:
    image: redis:7.4.2
    ports:
      - "16380:6379"
    networks:
      - redis-cluster
    volumes:
      - ./data/master:/data
      - ./node/master/redis.conf:/usr/local/etc/redis/redis.conf
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 5s
      retries: 3

  redis-slaver1:
    image: redis:7.4.2
    ports:
      - "16381:6379"
    networks:
      - redis-cluster
    volumes:
      - ./data/sl1:/data
      - ./node/s1/redis.conf:/usr/local/etc/redis/redis.conf
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      redis-master:
        condition: service_healthy
  redis-slaver2:
    image: redis:7.4.2
    ports:
      - "16382:6379"
    networks:
      - redis-cluster
    volumes:
      - ./data/sl2:/data
      - ./node/s2/redis.conf:/usr/local/etc/redis/redis.conf
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      redis-master:
        condition: service_healthy
  redis-slaver3:
    image: redis:7.4.2
    ports:
      - "16383:6379"
    networks:
      - redis-cluster
    volumes:
      - ./data/sl3:/data
      - ./node/s3/redis.conf:/usr/local/etc/redis/redis.conf
    command: [ "redis-server", "/usr/local/etc/redis/redis.conf" ]
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      redis-master:
        condition: service_healthy

  redis-sentinell:
    image: redis:7.4.2
    ports:
      - "26379:26379"
    networks:
      - redis-cluster
    volumes:
      - ./sentinel/s1/sentinel.conf:/usr/local/etc/redis/sentinel.conf # 挂载配置文件
      - ./data/s1:/data
    command: [ "redis-sentinel", "/usr/local/etc/redis/sentinel.conf" ]
    depends_on:
      redis-master:
        condition: service_healthy
      redis-slaver1:
        condition: service_healthy
      redis-slaver2:
        condition: service_healthy
      redis-slaver3:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 10s
      timeout: 5s
      retries: 3
  redis-sentinel2:
    image: redis:7.4.2
    ports:
      - "26380:26379"
    networks:
      - redis-cluster
    volumes:
      - ./sentinel/s2/sentinel.conf:/usr/local/etc/redis/sentinel.conf # 挂载配置文件
      - ./data/s2:/data
    command: [ "redis-sentinel", "/usr/local/etc/redis/sentinel.conf" ]
    depends_on:
      redis-master:
        condition: service_healthy
      redis-slaver1:
        condition: service_healthy
      redis-slaver2:
        condition: service_healthy
      redis-slaver3:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 10s
      timeout: 5s
      retries: 3
  redis-sentinel3:
    image: redis:7.4.2
    ports:
      - "26381:26379"
    networks:
      - redis-cluster
    volumes:
      - ./sentinel/s3/sentinel.conf:/usr/local/etc/redis/sentinel.conf # 挂载配置文件
      - ./data/s3:/data
    command: [ "redis-sentinel", "/usr/local/etc/redis/sentinel.conf" ]
    depends_on:
      redis-master:
        condition: service_healthy
      redis-slaver1:
        condition: service_healthy
      redis-slaver2:
        condition: service_healthy
      redis-slaver3:
        condition: service_healthy
    healthcheck:
      test: [ "CMD", "redis-cli", "ping" ]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  redis-cluster:
    driver: bridge
